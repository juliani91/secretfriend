<!DOCTYPE html>
<html>
<head>
    <title>Secret Friend</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
     <link rel="stylesheet" href="/public/css/style.css">
    <script>
// shuffling the array names   it repeats on 0 so change
function shuffleArray(array){
    for(var i = array.length - 1; i > 0; i--){
        var j = Math.floor(Math.random() * (i + 1));
    var temp = array[i];
    array[i] = array[j];
    array[j] = temp;
    }
    return array;
}

// global variables
var ids = "email";
var ids2 = "msg";
var emailArray = [];
var nameArray = [];
///////////generate inputs
$(document).ready(function(){
    $("#btn1").click(function(){
        var first_value = $("#allOptions").val();
    
        for(var i=0; i<first_value; i++){
            $("#firstForm").append('<input type="text" placeholder="Enter your Email" id="' + (ids +(1+i))  + '"><br/>');
            $("#firstForm").append('<input type="text" placeholder="Enter your name" id="' + (ids2 +(1+i))  + '"><br/><br/>');

           emailArray.push("#" +ids + (i+1)); // create ids
           nameArray.push("#" +ids2 + (i+1)); // create ids


        }
        $("#small_form").css("display", "none");
        shuffleArray(nameArray); // testing shuffle then printing. test shuffleArray and shuffle
        // console.log(emailArray);
         //console.log(nameArray);
        display2(emailArray, nameArray); // pass both variables to another function
        });
    });


function display2(mail, name){
    var to,subject;
    $("#send_email").css("display", "block");
    //Start creating variables for the field names
    $("#send_email").click(function(){
        // name array contains the variables from the user input in form msg1 msg2 etc...
        // for loop for iterating whole array
        
        for(var i=0; i<mail.length; i++){
            to = $(mail[i]).val(); // get all the emails
            subject = $(name[i]).val();// get all the names
            //console.log(to);
            //console.log(subject);
        $.get("/send",{to:to,subject:subject},function(){
            console.log("Email sent");
            $("#message").text("Emails sent, please check your inbox.");
        });  
      
    }// end of LOOP
       
    });

}
</script>
</head>
<body>

<div id="container">
<div></div>

<div>
<h1>Secret Friend Raffle</h1>
<!-- Append inputs to the form from jquery -->
    <form name="form1" id="firstForm">
        
    </form>
<!-- select menu accessed from jquery -->
    <div id="small_form">
        <select id="allOptions">
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
        </select>
        <input type="button" value="Generate" id="btn1">
    </div>

<button id="send_email" style="display:none;">Send Email</button>
<span id="message"></span>
</div>
<img src="/public/img.gif" alt="place" />
</body>
</html>